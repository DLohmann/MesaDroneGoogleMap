<!DOCTYPE html>
<html>
	<head>
	<meta name="viewport" content="initial-scale=1.0,user-scalable=no" />
	<meta charset="utf-8"/>
	<style type="text/css">
		html { height: 100% }
		body { height: 75%; margin: 0; padding: 0 }
		#map-canvas { height: 100% }
	</style>
	<script type="text/javascript"
		src="https://maps.googleapis.com/maps/api/js?
		key=AIzaSyALt375cV7B_ZO_HCHtKM6G79sJsyI0zmU
&libraries=drawing,geometry"></script>
	</head>
	<body ondragstart="return false">
		
		
		<label>Date: <label id="timeBox"></label>, Flight Time: <label id="flightTimeBox" style="font-weight:bold"></label> Minutes</label><br>
		<label>Position: </label><br>
		<label>Speed: <label id="flightSpeedBox" style="font-weight:bold"></label> mph</label><br>
		<label>Direction: </label><br>
		<label>Altitude: <label id="flightAltitudeBox" style="font-weight:bold"></label> ft</label></label><br>
	
		<h3>Restart Simulation:</h3>
		<div id="latitudeText" class="generalInputField">Latitude<span class="glyphicon glyphicon-menu-right" aria-hidden="true"></span>
		</div>
		<form id="latitudeForm" class="inputValue" onsubmit="initLocation(); return false">
			<input id="latitudeField" class="inputBorder numberField" type="number" step="any"  name="latitudeInput" value="37.374712"/>
		</form>
		
		<div id="longitudeText" class="generalInputField">Longitude<span class="glyphicon glyphicon-menu-right" aria-hidden="true"></span>
		</div>
		<form id="longitudeForm" class="inputValue" onsubmit="initLocation(); return false">
			<input id="longitudeField" class="inputBorder numberField" type="number" step="any" name="longitudeInput" value="-120.577858"/>
		</form>
		<br>
		
		
		
		<br>
		<button type="button" id="startButton" onclick="initLocation(); return false">Start Program</button>
		<br>
		
		
		<div id ="map-canvas"></div>
		<input class="w3-button w3-black" type="button" value="Input Button">
		
		
		
		
		
		
		<script type="text/javascript" >
			var map;
			var currentTime = 0.0;
			//var currentDate = new Date();
			var startTime = new Date();
			var marker;
			// Starting position of the map
			var latitude = 37.374712;
			var longitude = -120.577858;
			var speed = 0.0;
			var altitude = 0.0;
			
			// Current and previous position of drone
			var droneLatLng = new google.maps.LatLng (latitude, longitude);;
			var lastDroneLatLng = droneLatLng;
			var lastPositionUpdateTime = 0.0;
			
			function initialize()
			{
				console.log('Initializing Map!');
				// Add map
				var mapOptions =
				{
					// center: new google.maps.LatLng(37.374712, -120.577858),
					center: new google.maps.LatLng(latitude, longitude),
					zoom: 19,
					mapTypeId: google.maps.MapTypeId.SATELLITE,
				};
				map = new google.maps.Map(document.getElementById("map-canvas"), mapOptions);
				map.setTilt(0);
				
				var drawingManager = new google.maps.drawing.DrawingManager({
					drawingMode: google.maps.drawing.OverlayType.MARKER,
					drawingControl: true,
					drawingControlOptions: {
						position: google.maps.ControlPosition.TOP_CENTER,
						drawingModes: ['marker', 'circle', 'polygon', 'polyline', 'rectangle']
					},
					markerOptions: {icon: 'https://developers.google.com/maps/documentation/javascript/examples/full/images/beachflag.png'},
					circleOptions: {
						fillColor: 'rgba(0, 98, 255, 0.46)',
						fillOpacity: 1,
						strokeWeight: 5,
						clickable: false,
						editable: true,
						zIndex: 1
					}
				});
				drawingManager.setMap(map);
				
				// Add event listener
				google.maps.event.addListener(map, 'zoom_changed',
					function()
					{
					//alert(map.getZoom());
					}
				);
				
				// Add marker
				marker = new google.maps.Marker(
				{
					position: new google.maps.LatLng(37.374712, -120.577858),
					map: map,
					title: "Marker A",
				});
				google.maps.event.addListener(marker, 'click', function()
				{
					map.panTo(marker.getPosition());
				});
				marker.setMap(map); 
			}
			
			
			
			google.maps.event.addDomListener(window, 'load', initialize);
			
			function updateLocation(lat,lon){
				//latitude = lat;
				//longitude = lon;
				//map.setCenter      (latitude, longitude, 0);
				
				lastDroneLatLng = droneLatLng;
				droneLatLng = new google.maps.LatLng (lat, lon);
				
				var distance = google.maps.geometry.spherical.computeDistanceBetween(lastDroneLatLng, droneLatLng);	// compute distance between previous and current location in meters
				
				speed = (2236.94 * distance)/(Date.now() - lastPositionUpdateTime); // time is in milliseconds, so multiply by 1000 to get seconds, so speed is in meters per second. Then multiply by 2.23694 to get miles per hour
				lastPositionUpdateTime = Date.now();
				
				//marker.setPosition (latitude, longitude, 0);
				marker.setPosition (droneLatLng);
				
				console.log ("Updated location to (" + latitude + ", " + longitude + ")\n");
			};
			
			function circlePoint(time) {
				var radius = 0.0005;
				var x = Math.cos(time/10000) * radius;
				var y = Math.sin(time/10000) * radius;
				updateLocation (latitude + x, longitude + y);
				altitude = 50*Math.sin(time/10000) + 100;
				//return {lat:window.lat + y, lng:window.lng + x};
			};
			
			function updateMap () {
				currentTime = Date.now() - startTime;	//currentTime + 0.010;
				circlePoint (currentTime);
				updateFlightInfoText();
			}
			
			function initLocation(){
				latitude = Number (document.forms[0].latitudeInput.value);
				longitude = Number(document.forms[1].longitudeInput.value);
				initialize();
			}
			
			function updateFlightInfoText() {
				//document.getElementById("latitudeField").value  = 'latitude';
				//document.getElementById("longitudeField").value = 'longitude';
				//var TimeBox = document.getElementById("timeBox");
				//TimeBox.setAttribute('value', "hi");
				document.getElementById("timeBox").innerHTML       = new Date().toGMTString();	//Math.round((Date.now() - startTime)/1000);	//(Date.now() - startTime.get)/1000;
				document.getElementById("flightTimeBox").innerHTML = Math.round((Date.now() - startTime)/60000)
				document.getElementById("flightSpeedBox").innerHTML = speed;
				document.getElementById("flightAltitudeBox").innerHTML = altitude;
				
			}
			
			setInterval ("updateMap ()", 500);
			
		</script>
	</body>
</html>
